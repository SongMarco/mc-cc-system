---
name: review-plan
description: 구현 계획을 staff engineer 관점에서 리뷰한다
allowed-tools: Read, Glob, Grep
argument-hint: [plan 파일 경로]
---

## 구현 계획 리뷰 워크플로우

사용자 요청: `$ARGUMENTS`

### 1. Plan 소스 확인

$ARGUMENTS가 있으면 해당 파일을 읽는다.

$ARGUMENTS가 비어있으면 `~/.claude/plans/` 디렉토리에서 가장 최근 수정된 plan 파일을 찾아서 읽는다.
Glob으로 `~/.claude/plans/*.md` 패턴을 검색하고, 결과 중 가장 최근 파일을 선택한다.

plan 파일을 찾을 수 없으면 사용자에게 경로를 요청한다.

### 2. 코드베이스 크로스체크

plan에서 언급된 파일 경로, 클래스명, 함수명, 패턴을 추출한다.

아래 항목을 검증한다:

- plan에서 수정/생성 대상으로 언급한 파일이 실제로 존재하는지 Glob으로 확인한다
- plan에서 참조하는 기존 코드(클래스, 함수, 패턴)가 실제 코드베이스에 존재하는지 Grep으로 확인한다
- 기존 코드와 plan의 변경사항이 충돌하지 않는지 분석한다
- 이미 유사한 기능이 존재하는지 확인한다

### 3. Staff Engineer 리뷰

아래 5가지 관점에서 plan을 분석한다. 각 관점에서 최소 1개 이상의 발견 사항을 도출하도록 회의적으로 검토한다.

#### 3-1. 엣지 케이스

plan이 다루지 않는 경계 조건을 찾는다:

- 빈 입력, null/undefined 처리
- 동시성 문제 (race condition)
- 대량 데이터 처리
- 네트워크 실패, 타임아웃

#### 3-2. 가정 검증

plan에서 명시적/암묵적으로 전제하는 가정 중 성립하지 않을 수 있는 것을 찾는다:

- 특정 라이브러리/API의 동작 방식에 대한 가정
- 데이터 구조나 스키마에 대한 가정
- 환경(배포, 인프라)에 대한 가정

#### 3-3. 더 단순한 대안

불필요하게 복잡한 부분이 있는지 검토한다:

- 기존 유틸리티나 라이브러리로 대체 가능한 구현
- 과도한 추상화
- YAGNI 위반 (당장 필요하지 않은 기능)

#### 3-4. 성능 이슈

잠재적 병목을 찾는다:

- N+1 쿼리
- 불필요한 전체 데이터 로드
- 인덱스 누락 가능성
- 메모리 누수 패턴

#### 3-5. 누락된 항목

plan에서 빠진 중요한 사항을 찾는다:

- 에러 처리 전략
- 테스트 계획
- 마이그레이션 계획 (DB 스키마 변경 시)
- 롤백 전략
- 기존 API 하위 호환성

### 4. 리뷰 결과 보고

아래 형식으로 정리하여 출력한다. 심각도 순서로 정렬한다.

```
## Plan 리뷰 결과

**대상**: [plan 파일명]
**리뷰어**: Staff Engineer (자동)

---

### BLOCKER (반드시 수정 필요)

- [B-1] 제목
  - 문제: ...
  - 근거: ...
  - 제안: ...

### CONCERN (검토 권장)

- [C-1] 제목
  - 문제: ...
  - 근거: ...
  - 제안: ...

### SUGGESTION (개선 제안)

- [S-1] 제목
  - 문제: ...
  - 근거: ...
  - 제안: ...

---

**요약**: BLOCKER N건 / CONCERN N건 / SUGGESTION N건
**판정**: BLOCKER가 0건이면 "진행 가능 (concerns 검토 후)", 1건 이상이면 "수정 후 재리뷰 필요"
```
